FS = require 'fs'
{ get_time } = require './utils.coffee'

write_db = ->
  FS.writeFileSync './db.json', JSON.stringify({
    last_updated: new Date()
    list: [
      [258, '卡马克的猫', [2023, 6, 9]]
      [257, '黄仁勋的 Nvidia 故事', [2023, 6, 2]]
      [256, '最酷的乐高作品', [2023, 5, 26]]
      [255, '对待 AI 的正确态度', [2023, 5, 19]]
      [254, '人生是一个长板问题', [2023, 5, 12]]
      [253, '训练材料用完之日', [2023, 5, 5]]
      [252, '互联网创业变难了', [2023, 4, 28]]
      [251, '国产单板机值得推荐', [2023, 4, 21]]
      [250, '新技术的最大风险', [2023, 4, 14]]
      [249, '最成功的软件企业家', [2023, 4, 7]]
      [248, '不要夸大 ChatGPT', [2023, 3, 31]]
      [247, '扎克伯格的裁员信', [2023, 3, 24]]
      [246, '永不丢失的网络身份', [2023, 3, 17]]
      [245, '摩天大楼是反人类的', [2023, 3, 10]]
      [244, '大数据已死', [2023, 3, 3]]
      [243, '与孔子 AI 聊天', [2023, 2, 24]]
      [242, '一次尴尬的服务器被黑', [2023, 2, 17]]
      [241, '中国的增长动力在内陆', [2023, 2, 10]]
      [240, '教育年限可以缩短吗？', [2023, 2, 3]]
      [239, '未来两种人会增加', [2023, 1, 13]]
      [238, '停止寻找的最佳时间', [2023, 1, 6]]
      [237, '真实方位是如何暴露的？', [2022, 12, 30]]
      [236, '中国的阳光地带', [2022, 12, 23]]
      [235, '青年失业率与选择创业', [2022, 12, 16]]
      [234, 'AI 聊天有多强？', [2022, 12, 9]]
      [233, '生活就像一个鱼缸', [2022, 12, 2]]
      [232, '好用的平面设计软件', [2022, 11, 25]]
      [231, '互联网公司需要多少员工？', [2022, 11, 18]]
      [230, '电子产品的用电量', [2022, 11, 11]]
      [229, '手机充电问题的解决', [2022, 11, 4]]
      [228, '人类和人生的意义', [2022, 10, 28]]
      [227, '脸书的公司入职教育', [2022, 10, 21]]
      [226, '谷歌出了什么问题？', [2022, 10, 14]]
      [225, 'NPC 演员也是一种职业', [2022, 9, 30]]
      [224, 'Figma 为什么赢了 Sketch', [2022, 9, 23]]
      [223, '程序员需要担心裁员吗？', [2022, 9, 16]]
      [222, '四十年编程感想', [2022, 9, 9]]
      [221, '全世界最繁荣的行业', [2022, 9, 2]]
      [220, '人工智能的机会在哪里', [2022, 8, 26]]
      [219, '如何防止帐号被黑', [2022, 8, 19]]
      [218, '葡萄酒，樱花，全球变暖', [2022, 8, 12]]
      [217, '沙特的新未来城', [2022, 8, 5]]
      [216, '极简主义的胜利', [2022, 7, 29]]
      [215, '互联网最喜欢的行为模式', [2022, 7, 22]]
      [214, '你的地图是错的', [2022, 7, 15]]
      [213, '知识孤岛，知识软件', [2022, 7, 8]]
      [212, '人生不短', [2022, 7, 1]]
      [211, '虚拟商品可以拉动 GDP', [2022, 6, 24]]
      [210, '为什么软件变得复杂', [2022, 6, 17]]
      [209, '程序员是怎样的人', [2022, 6, 10]]
      [208, '晋升制度的问题', [2022, 5, 27]]
      [207, '汽车行业的顶峰可能过去了', [2022, 5, 20]]
      [206, '如何走出失望和怀疑', [2022, 5, 13]]
      [205, '互联网风口过去了吗？', [2022, 5, 6]]
      [204, '如何度过疫情、裁员、还有战争', [2022, 4, 22]]
      [203, '英国的名校签证，伯克利的计算机教育', [2022, 4, 15]]
      [202, '三个有启发的学习方法', [2022, 4, 8]]
      [201, '中国需要成立半导体部', [2022, 4, 1]]
      [200, '低期望，多尝试', [2022, 3, 25]]
      [199, '俄罗斯的 HTTPS 证书问题', [2022, 3, 18]]
      [198, '美国制造是否可能', [2022, 3, 11]]
      [197, '如果这个世界有快乐机', [2022, 3, 4]]
      [196, '掌机的未来', [2022, 2, 25]]
      [195, '你做过不在乎结果的项目吗？', [2022, 2, 18]]
      [194, '悲观者正确，乐观者成功', [2022, 2, 11]]
      [193, '前端与后端，谁更难？', [2022, 1, 21]]
      [192, '最大的机会来自新技术', [2022, 1, 14]]
      [191, '一个程序员的财务独立之路', [2022, 1, 7]]
      [190, '产品化思维', [2021, 12, 31]]
      [189, '下一个内卷的行业', [2021, 12, 24]]
      [188, '音乐是反社交', [2021, 12, 17]]
      [187, '元宇宙会成功吗', [2021, 12, 10]]
      [186, '低纬度，高海拔，气候优势', [2021, 12, 3]]
      [185, '美国宪法拍卖，一个区块链案例', [2021, 11, 26]]
      [184, '政府的存储需求有多大？', [2021, 11, 19]]
      [183, '腾讯的员工退休福利', [2021, 11, 12]]
      [182, '新人优惠的风险', [2021, 11, 5]]
      [181, '移动支付应该怎么设计？', [2021, 10, 29]]
      [180, '你想住在中国哪里？', [2021, 10, 22]]
      [179, 'AR 技术的打开方式', [2021, 10, 15]]
      [178, '家庭太阳能发电的春天', [2021, 10, 8]]
      [177, 'iPad 的真正用途', [2021, 9, 24]]
      [176, '中国法院承认 GPL 吗？', [2021, 9, 17]]
      [175, '知识广度 vs 知识深度', [2021, 9, 10]]
      [174, '全能程序员 vs 特长程序员', [2021, 9, 3]]
      [173, '网络收音机的设计', [2021, 8, 27]]
      [172, '我们会死于气候灾难吗？', [2021, 8, 20]]
      [171, '云服务流量有多贵？', [2021, 8, 13]]
      [170, '软件订阅制的胜利', [2021, 8, 6]]
      [169, '五菱汽车的产品设计', [2021, 7, 30]]
      [168, '游戏《底特律：变人》', [2021, 7, 23]]
      [167, '广告拦截器太过分了', [2021, 7, 16]]
      [166, '视频学习胜过读书吗？', [2021, 7, 9]]
      [165, '全端 App 的时代', [2021, 7, 2]]
      [164, '培训班 vs 大学，求职成功率比较', [2021, 6, 25]]
      [163, '你的城市有多少张病床？', [2021, 6, 18]]
      [162, '生活就像《吃豆人》游戏', [2021, 6, 11]]
      [161, '再见了，学术硕士', [2021, 6, 4]]
      [160, '中年码农的困境', [2021, 5, 28]]
      [159, '游戏开发者的年薪', [2021, 5, 21]]
      [158, '内容渠道的贬值', [2021, 5, 14]]
      [157, 'KK 给年轻人的建议', [2021, 5, 7]]
      [156, '显卡缺货与异业竞争', [2021, 4, 30]]
      [155, '数字货币是打破美元霸权的武器吗？', [2021, 4, 23]]
      [154, '1982年的信息社会预言', [2021, 4, 16]]
      [153, '机器翻译是对译者的侮辱吗？', [2021, 4, 9]]
      [152, '从北大到技校', [2021, 4, 2]]
      [151, 'NFT 是什么，听说能赚钱', [2021, 3, 26]]
      [150, '当音乐还是稀缺的时候', [2021, 3, 19]]
      [149, '新能源汽车，谁会是赢家？', [2021, 3, 12]]
      [148, '微增长时代', [2021, 3, 5]]
      [147, '寻找你愿意忍受的痛苦', [2021, 2, 26]]
      [146, '网课应该怎么上？', [2021, 2, 19]]
      [145, '大家不出门，经济怎么办？', [2021, 2, 5]]
      [144, '提高收入的根本途径', [2021, 1, 29]]
      [143, '世界尽头与冷酷仙境', [2021, 1, 22]]
      [142, '2020年才是21世纪元年', [2021, 1, 15]]
      [141, '封闭系统的胜利', [2021, 1, 8]]
      [140, '印度人的工资是多少？', [2020, 12, 31]]
      [139, '生物学的可怕进展', [2020, 12, 25]]
      [138, '失业难以避免，重构人生规划', [2020, 12, 18]]
      [137, 'Slack 被收购，以及企业的技术选型', [2020, 12, 11]]
      [136, '利特伍德奇迹定律', [2020, 12, 4]]
      [135, '利特伍德奇迹定律', [2020, 11, 27]]
      [134, '未来的游戏业比现在大100倍', [2020, 11, 20]]
      [133, '贵州变瑞士，有没有可能？', [2020, 11, 13]]
      [132, '快能力和慢能力', [2020, 11, 6]]
      [131, '你的头脑是二值逻辑，还是三值逻辑？', [2020, 10, 30]]
      [130, '低龄化的互联网', [2020, 10, 23]]
      [129, '创业的凸函数和凹函数', [2020, 10, 16]]
      [128, '这个社会是否正在变成"赛博朋克"？', [2020, 10, 9]]
      [127, '未来人人开发软件，几乎没人编码', [2020, 9, 30]]
      [126, '内卷化是什么？', [2020, 9, 25]]
      [125, '数字人民币要取代谁', [2020, 9, 18]]
      [124, '华为如何考核员工', [2020, 9, 11]]
      [123, '互联网公司与湘军的军制', [2020, 9, 4]]
      [122, '谈谈互联网公司的高估值', [2020, 8, 28]]
      [121, '为什么人类没有越来越闲？', [2020, 8, 21]]
      [120, '只有开放才能打败封锁', [2020, 8, 14]]
      [119, '降雨量和保险博弈', [2020, 8, 7]]
      [118, '高考志愿怎么填', [2020, 7, 31]]
      [117, '我不想让你记住我的脸', [2020, 7, 24]]
      [116, '世界的未来是一个火药桶', [2020, 7, 17]]
      [115, '保护你的 DNA，不要泄漏', [2020, 7, 10]]
      [114, 'U 盘化生存和 Uber-job', [2020, 7, 3]]
      [113, '暴力犯罪为什么越来越少？', [2020, 6, 24]]
      [112, '如何培养领导力', [2020, 6, 19]]
      [111, '智能电视的误区', [2020, 6, 12]]
      [110, '如果不能去美国上市', [2020, 6, 5]]
      [109, '播客的价值', [2020, 5, 29]]
      [108, '阵地战与奇袭战', [2020, 5, 22]]
      [107, '致富与杠杆', [2020, 5, 15]]
      [106, '数字游民', [2020, 5, 8]]
      [105, [2020, 4, 30]]
      [104, [2020, 4, 24]]
      [103, [2020, 4, 17]]
      [102, [2020, 4, 10]]
      [101, [2020, 4, 3]]
      [100, [2020, 3, 27]]
      [99, [2020, 3, 20]]
      [98, [2020, 3, 13]]
      [97, [2020, 3, 6]]
      [96, [2020, 2, 28]]
      [95, [2020, 2, 21]]
      [94, [2020, 2, 14]]
      [93, [2020, 2, 7]]
      [92, [2020, 1, 31]]
      [91, [2020, 1, 17]]
      [90, [2020, 1, 10]]
      [89, [2020, 1, 3]]
      [88, [2019, 12, 27]]
      [87, [2019, 12, 20]]
      [86, [2019, 12, 13]]
      [85, [2019, 12, 6]]
      [84, [2019, 11, 29]]
      [83, [2019, 11, 22]]
      [82, [2019, 11, 15]]
      [81, [2019, 11, 8]]
      [80, [2019, 11, 1]]
      [79, [2019, 10, 25]]
      [78, [2019, 10, 18]]
      [77, [2019, 10, 11]]
      [76, [2019, 10, 4]]
      [75, [2019, 9, 27]]
      [74, [2019, 9, 20]]
      [73, [2019, 9, 13]]
      [72, [2019, 9, 6]]
      [71, [2019, 8, 30]]
      [70, [2019, 8, 23]]
      [69, [2019, 8, 16]]
      [68, [2019, 8, 9]]
      [67, [2019, 8, 2]]
      [66, [2019, 7, 26]]
      [65, [2019, 7, 19]]
      [64, [2019, 7, 12]]
      [63, [2019, 7, 5]]
      [62, [2019, 6, 28]]
      [61, [2019, 6, 21]]
      [60, [2019, 6, 14]]
      [59, [2019, 6, 7]]
      [58, [2019, 5, 31]]
      [57, [2019, 5, 24]]
      [56, [2019, 5, 17]]
      [55, [2019, 5, 10]]
      [54, [2019, 5, 3]]
      [53, [2019, 4, 26]]
      [52, [2019, 4, 19]]
      [51, [2019, 4, 12]]
      [50, [2019, 4, 5]]
      [49, [2019, 3, 29]]
      [48, [2019, 3, 22]]
      [47, [2019, 3, 15]]
      [46, [2019, 3, 8]]
      [45, [2019, 3, 1]]
      [44, [2019, 2, 22]]
      [43, [2019, 2, 15]]
      [42, [2019, 2, 1]]
      [41, [2019, 1, 25]]
      [40, [2019, 1, 18]]
      [39, [2019, 1, 11]]
      [38, [2019, 1, 4]]
      [37, [2018, 12, 28]]
      [36, [2018, 12, 21]]
      [35, [2018, 12, 14]]
      [34, [2018, 12, 7]]
      [33, [2018, 11, 30]]
      [32, [2018, 11, 23]]
      [31, [2018, 11, 16]]
      [30, [2018, 11, 9]]
      [29, [2018, 11, 2]]
      [28, [2018, 10, 26]]
      [27, [2018, 10, 19]]
      [26, [2018, 10, 12]]
      [25, [2018, 10, 5]]
      [24, [2018, 9, 28]]
      [23, [2018, 9, 21]]
      [22, [2018, 9, 14]]
      [21, [2018, 9, 7]]
      [20, [2018, 8, 31]]
      [19, [2018, 8, 24]]
      [18, [2018, 8, 17]]
      [17, [2018, 8, 10]]
      [16, [2018, 8, 3]]
      [15, [2018, 7, 27]]
      [14, [2018, 7, 20]]
      [13, [2018, 7, 13]]
      [12, [2018, 7, 6]]
      [11, [2018, 6, 29]]
      [10, [2018, 6, 22]]
      [9, [2018, 6, 14]]
      [8, [2018, 6, 8]]
      [7, [2018, 6, 1]]
      [6, [2018, 5, 25]]
      [5, [2018, 5, 18]]
      [4, [2018, 5, 11]]
      [3, [2018, 5, 4]]
      [2, [2018, 4, 28]]
      [1, [2018, 4, 22]]
    ].map ([number, title, date]) ->
      if !date
        date = title
        title = null
      
      [year, month, day] = date
      return {
        number
        title
        date: new Date year, month - 1, day, 1
      }
  }, null, 2)

check_db = ->
  raw = JSON.parse FS.readFileSync './db.json'
  do -> # 总共 258
    unless raw.list.length == 258
      throw Error '遗漏了，不够 258'
    console.log '总共 258'
  
  do -> # last_updated
    last_updated = new Date(raw.last_updated).getTime()
    unless last_updated > 0 && !isNaN(last_updated) && last_updated < new Date().getTime()
      throw Error 'last_updated error'
    console.log 'last_updated valid'
  
  do -> # 周五发布
    raw.list.forEach (item) ->
      target = new Date item.date
      unless target.getDay() == 5 || [140, 127, 113, 105, 9, 2, 1].includes(item.number)
        console.debug target, item.number
        throw Error '不是周五发布吗'
    console.log '都是周五发布的，除了,,,'
  
  do -> # 日期递增
    for i in [0...raw.list.length-1]
      unless (get_time raw.list[i].date) > (get_time raw.list[i + 1].date)
        console.debug i
        console.debug get_time raw.list[i].date
        console.debug get_time raw.list[i + 1].date
        throw Error '时间非递增'
    console.log '时间是递增的'
  
  do -> # 检查标题
    raw.list.forEach (item) ->
      unless (item.title && item.title.length > 0) || (item.number < 106 && item.title == null)
        console.debug item
        throw Error '标题不正常'
    console.log '标题正常'
  
write_db()
check_db()
